<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent Debate System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .setup-panel {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .api-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .api-info strong {
            color: #856404;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .agent-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .agent-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .agent-card textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            min-height: 100px;
            font-size: 0.95em;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            padding: 12px 30px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .debate-area {
            padding: 30px;
            display: none;
        }

        .debate-area.active {
            display: block;
        }

        .debate-status {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .debate-status strong {
            color: #2196F3;
        }

        .messages-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 25px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .agent-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            margin-right: 15px;
        }

        .agent-1 .agent-avatar { background: #667eea; }
        .agent-2 .agent-avatar { background: #f093fb; }
        .agent-3 .agent-avatar { background: #4facfe; }

        .message-info {
            flex: 1;
        }

        .agent-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #333;
        }

        .round-info {
            font-size: 0.9em;
            color: #6c757d;
        }

        .message-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .summary-section {
            background: #f0f8ff;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .summary-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .summary-content {
            line-height: 1.8;
            color: #333;
        }

        .error-message {
            background: #fff3f3;
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            color: #c62828;
            margin-bottom: 20px;
        }

        .scrollbar-custom::-webkit-scrollbar {
            width: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ Multi-Agent Debate System</h1>
            <p>Watch AI agents engage in structured debates with unique perspectives</p>
        </div>

        <div class="setup-panel" id="setupPanel">
            <div class="api-info">
                <strong>‚ö†Ô∏è API Key Required:</strong> This demo uses OpenAI's API. You'll need an API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI</a>. The key is stored only in your browser session.
            </div>

            <div class="input-group">
                <label>OpenAI API Key</label>
                <input type="password" id="apiKey" placeholder="sk-..." />
            </div>

            <div class="input-group">
                <label>Debate Topic</label>
                <textarea id="debateTopic" placeholder="Should UCLA require CS majors to take linguistics?">Should UCLA require CS majors to take linguistics?</textarea>
            </div>

            <div class="input-group">
                <label>Number of Rounds</label>
                <select id="numRounds">
                    <option value="2">2 rounds</option>
                    <option value="3" selected>3 rounds</option>
                    <option value="4">4 rounds</option>
                    <option value="5">5 rounds</option>
                </select>
            </div>

            <div class="input-group">
                <label>AI Model</label>
                <select id="modelSelect">
                    <option value="gpt-4o-mini">GPT-4o-mini (faster, cheaper)</option>
                    <option value="gpt-4o">GPT-4o (most capable)</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (budget)</option>
                </select>
            </div>

            <h2 style="margin-top: 30px; margin-bottom: 15px; color: #333;">Configure Agent Personas</h2>
            <div class="agents-grid">
                <div class="agent-card">
                    <h3>Agent 1: The Pragmatist</h3>
                    <textarea id="agent1Persona" placeholder="Define Agent 1's perspective...">You are a pragmatic computer science professor who values practical skills and industry readiness. You believe CS education should focus on technical skills that directly apply to software engineering careers. You're skeptical of requirements that don't clearly enhance employability.</textarea>
                </div>

                <div class="agent-card">
                    <h3>Agent 2: The Interdisciplinarian</h3>
                    <textarea id="agent2Persona" placeholder="Define Agent 2's perspective...">You are an interdisciplinary scholar who believes in the intersection of computer science and linguistics. You argue that understanding language, semantics, and communication theory enhances AI/NLP work, user interface design, and makes better-rounded technologists.</textarea>
                </div>

                <div class="agent-card">
                    <h3>Agent 3: The Student Advocate</h3>
                    <textarea id="agent3Persona" placeholder="Define Agent 3's perspective...">You are a current UCLA CS student who represents student perspectives. You're concerned about degree requirements, workload, costs, and graduation timelines. You want requirements to be justified and beneficial, not just add to the burden without clear value.</textarea>
                </div>
            </div>

            <div class="controls">
                <button class="btn-primary" id="startDebateBtn">Start Debate</button>
            </div>
        </div>

        <div class="debate-area" id="debateArea">
            <div class="debate-status" id="debateStatus">
                <strong>Status:</strong> <span id="statusText">Initializing...</span>
            </div>

            <div id="errorContainer"></div>

            <div class="messages-container scrollbar-custom" id="messagesContainer">
                <!-- Messages will be added here dynamically -->
            </div>

            <div class="controls">
                <button class="btn-primary" id="nextRoundBtn" style="display: none;">Next Round</button>
                <button class="btn-secondary" id="newDebateBtn">New Debate</button>
            </div>

            <div class="summary-section" id="summarySection" style="display: none;">
                <h3>üìä Debate Summary</h3>
                <div class="summary-content" id="summaryContent"></div>
            </div>
        </div>
    </div>

    <script>
        class DebateAgent {
            constructor(name, persona, color) {
                this.name = name;
                this.persona = persona;
                this.color = color;
                this.conversationHistory = [];
            }

            addToHistory(role, content) {
                this.conversationHistory.push({ role, content });
            }

            getSystemPrompt(topic, round, totalRounds) {
                return `${this.persona}

You are participating in a structured debate about: "${topic}"

This is round ${round} of ${totalRounds}.

DEBATE RULES:
1. Stay in character according to your perspective
2. Make clear, well-reasoned arguments
3. Respond to previous speakers' points
4. Be respectful but assertive
5. Keep responses focused and concise (2-3 paragraphs)
6. Use evidence or examples when possible

${round === 1 ? 'Present your opening position on this topic.' : 'Respond to the previous arguments and develop your position further.'}`;
            }
        }

        class DebateSystem {
            constructor() {
                this.agents = [];
                this.currentRound = 0;
                this.totalRounds = 3;
                this.topic = '';
                this.apiKey = '';
                this.model = 'gpt-4o-mini';
                this.debateHistory = [];
                this.isRunning = false;
            }

            initialize(topic, numRounds, apiKey, model, agentPersonas) {
                this.topic = topic;
                this.totalRounds = numRounds;
                this.apiKey = apiKey;
                this.model = model;
                this.currentRound = 1;
                this.debateHistory = [];

                // Create agents with personas
                const agentConfigs = [
                    { name: 'The Pragmatist', color: '#667eea', persona: agentPersonas[0] },
                    { name: 'The Interdisciplinarian', color: '#f093fb', persona: agentPersonas[1] },
                    { name: 'The Student Advocate', color: '#4facfe', persona: agentPersonas[2] }
                ];

                this.agents = agentConfigs.map(config => 
                    new DebateAgent(config.name, config.persona, config.color)
                );
            }

            async callOpenAI(agent, round) {
                const messages = [
                    {
                        role: 'system',
                        content: agent.getSystemPrompt(this.topic, round, this.totalRounds)
                    },
                    ...agent.conversationHistory
                ];

                // Add context from other agents if available
                if (this.debateHistory.length > 0) {
                    const recentDebate = this.debateHistory
                        .slice(-6) // Last 6 messages
                        .map(entry => `${entry.agent}: ${entry.message}`)
                        .join('\n\n');
                    
                    messages.push({
                        role: 'user',
                        content: `Here's the recent debate context:\n\n${recentDebate}\n\nNow provide your argument for round ${round}.`
                    });
                } else {
                    messages.push({
                        role: 'user',
                        content: `Provide your opening statement on the topic: "${this.topic}"`
                    });
                }

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: this.model,
                        messages: messages,
                        temperature: 0.8,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API request failed');
                }

                const data = await response.json();
                const message = data.choices[0].message.content;

                // Add to agent's history
                agent.addToHistory('assistant', message);

                return message;
            }

            async runRound(round) {
                for (let i = 0; i < this.agents.length; i++) {
                    const agent = this.agents[i];
                    
                    try {
                        updateStatus(`Round ${round}/${this.totalRounds} - ${agent.name} is thinking...`);
                        showLoading();

                        const message = await this.callOpenAI(agent, round);
                        
                        this.debateHistory.push({
                            agent: agent.name,
                            message: message,
                            round: round,
                            agentIndex: i
                        });

                        hideLoading();
                        displayMessage(agent.name, message, round, i + 1);

                        // Small delay between agents
                        await this.sleep(1000);
                    } catch (error) {
                        hideLoading();
                        showError(`Error with ${agent.name}: ${error.message}`);
                        throw error;
                    }
                }
            }

            async generateSummary() {
                updateStatus('Generating debate summary...');
                showLoading();

                const summaryPrompt = `You are analyzing a debate between three AI agents about: "${this.topic}"

Here's the complete debate:

${this.debateHistory.map((entry, i) => 
    `[Round ${entry.round}] ${entry.agent}:\n${entry.message}\n`
).join('\n')}

Provide a comprehensive summary that includes:
1. Main arguments from each perspective
2. Key points of agreement and disagreement
3. Most compelling arguments made
4. Overall assessment of the debate quality

Keep it concise but thorough (3-4 paragraphs).`;

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify({
                            model: this.model,
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are an expert debate analyst who provides insightful summaries of discussions.'
                                },
                                {
                                    role: 'user',
                                    content: summaryPrompt
                                }
                            ],
                            temperature: 0.7,
                            max_tokens: 800
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate summary');
                    }

                    const data = await response.json();
                    const summary = data.choices[0].message.content;

                    hideLoading();
                    displaySummary(summary);
                } catch (error) {
                    hideLoading();
                    showError(`Error generating summary: ${error.message}`);
                }
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // UI Management
        const debateSystem = new DebateSystem();

        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }

        function showLoading() {
            const container = document.getElementById('messagesContainer');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.textContent = 'Thinking';
            container.appendChild(loadingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function hideLoading() {
            const loading = document.getElementById('loadingIndicator');
            if (loading) {
                loading.remove();
            }
        }

        function displayMessage(agentName, message, round, agentNum) {
            const container = document.getElementById('messagesContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message agent-${agentNum}`;
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="agent-avatar">${agentNum}</div>
                    <div class="message-info">
                        <div class="agent-name">${agentName}</div>
                        <div class="round-info">Round ${round}</div>
                    </div>
                </div>
                <div class="message-content">${message.replace(/\n/g, '<br>')}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        function displaySummary(summary) {
            const summarySection = document.getElementById('summarySection');
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = summary.replace(/\n/g, '<br>');
            summarySection.style.display = 'block';
        }

        // Event Handlers
        document.getElementById('startDebateBtn').addEventListener('click', async () => {
            const apiKey = document.getElementById('apiKey').value.trim();
            const topic = document.getElementById('debateTopic').value.trim();
            const numRounds = parseInt(document.getElementById('numRounds').value);
            const model = document.getElementById('modelSelect').value;

            if (!apiKey) {
                showError('Please enter your OpenAI API key');
                return;
            }

            if (!topic) {
                showError('Please enter a debate topic');
                return;
            }

            const agentPersonas = [
                document.getElementById('agent1Persona').value.trim(),
                document.getElementById('agent2Persona').value.trim(),
                document.getElementById('agent3Persona').value.trim()
            ];

            if (agentPersonas.some(p => !p)) {
                showError('Please provide personas for all three agents');
                return;
            }

            // Initialize debate
            debateSystem.initialize(topic, numRounds, apiKey, model, agentPersonas);

            // Switch to debate view
            document.getElementById('setupPanel').style.display = 'none';
            document.getElementById('debateArea').classList.add('active');
            document.getElementById('messagesContainer').innerHTML = '';
            document.getElementById('summarySection').style.display = 'none';

            // Run first round
            try {
                await debateSystem.runRound(1);
                debateSystem.currentRound++;

                if (debateSystem.currentRound <= debateSystem.totalRounds) {
                    updateStatus(`Round 1 complete. Ready for round ${debateSystem.currentRound}.`);
                    document.getElementById('nextRoundBtn').style.display = 'inline-block';
                } else {
                    updateStatus('Debate complete!');
                    await debateSystem.generateSummary();
                }
            } catch (error) {
                console.error('Debate error:', error);
            }
        });

        document.getElementById('nextRoundBtn').addEventListener('click', async () => {
            const btn = document.getElementById('nextRoundBtn');
            btn.disabled = true;

            try {
                await debateSystem.runRound(debateSystem.currentRound);
                debateSystem.currentRound++;

                if (debateSystem.currentRound <= debateSystem.totalRounds) {
                    updateStatus(`Round ${debateSystem.currentRound - 1} complete. Ready for round ${debateSystem.currentRound}.`);
                    btn.disabled = false;
                } else {
                    updateStatus('Debate complete!');
                    btn.style.display = 'none';
                    await debateSystem.generateSummary();
                }
            } catch (error) {
                console.error('Round error:', error);
                btn.disabled = false;
            }
        });

        document.getElementById('newDebateBtn').addEventListener('click', () => {
            document.getElementById('setupPanel').style.display = 'block';
            document.getElementById('debateArea').classList.remove('active');
            document.getElementById('nextRoundBtn').style.display = 'none';
        });

        // Load API key from session storage if available
        const savedApiKey = sessionStorage.getItem('openai_api_key');
        if (savedApiKey) {
            document.getElementById('apiKey').value = savedApiKey;
        }

        // Save API key to session storage when entered
        document.getElementById('apiKey').addEventListener('change', (e) => {
            sessionStorage.setItem('openai_api_key', e.target.value);
        });
    </script>
</body>
</html>
